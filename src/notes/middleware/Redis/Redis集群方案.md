---
title: "Redis集群方案"
date: 2024-04-14
---
### Redis集群方案有三种

**主从复制**

**哨兵模式**

**Redis Culster 分片**



## 主从复制：

主从复制是由从节点发出的，先进行 sync ,然后进行 

主从复制分为全量同步和增量同步两块



全量同步文字总结：
第一次主从链接时，
第一阶段：从节点会进行数据集校验(replid)，判断两个节点是否是同一个数据集，如果不是的话，从节点就是同步主节点的数据集ID，
	执行replicaof建立链接
	请求主节点进行数据同步
	主节点会判断请求过来的replid和主节点的replid是否一致，即是否是第一次同步，如果是第一次同步的话，就返回主节点的replid
	从节点接收replid，并修改节点replid为主节点的replid
	
第二阶段：RDB同步，主节点会生成对应的RDB文件，同时也会记录生成期间的执行信息，生成完毕后，推向从节点，让其加载
	执行bgsave命令生成RDB文件
	记录RDB生成期间的执行命令汇集到文件 repl_baklog 里
	推送RDB文件到从节点
	从节点清空当前的数据信息，加载RDB文件，保持和主节点的数据一致性


第三阶段：数据追加，会把生成RDB期间的执行信息集合成文件(repl_baklog)，然后推向从节点，让其保持和主节点的一致性
	推送 repl_bak_log中的命令到从节点中
	从节点接收并执行对应命令

注意点：
1. replid:
数据集的标记：标识数据集分组的唯一性，处于不同集群的Redis节点的replid是不一样的，对于统一分组的主从节点而言，replid都和主节点一致

2. offset:
字面意思偏移量，这个表明的是RDB同步之后 repl_baklog 的执行行数，如果从节点小于主节点，就说明需要进行增量同步

增量同步：
其实过程都一样，只不过因为replid相同了，所以直接拿offset 来获取未同步的 repl_baklog 数据。